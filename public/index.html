<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AgendaEst√©tica - SaaS de Agenda Online para Profissionais Est√©ticos">
    <meta name="theme-color" content="#6B46C1">
    
    <title>AgendaEst√©tica - Login</title>
    
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/login.css">
    
<!-- Firebase Configuration Placeholder -->
<script>

// Firebase Configuration - PLACEHOLDER MODE
// No valid environment variables found - running in demo mode
window.APP_CONFIG = {
    firebase: null,
    _demoMode: true
};
console.warn('‚ö†Ô∏è Firebase config NOT injected - running in demo mode');
console.warn('   Set VITE_FIREBASE_* environment variables in Vercel Dashboard');

</script>
<!-- End Firebase Configuration -->
    
    <script>
    // Check if Firebase config was injected at build time
    (function() {
        if (typeof window !== 'undefined' && window.APP_CONFIG && window.APP_CONFIG.firebase) {
            console.log('‚úÖ Firebase config loaded from build injection');
            return;
        }
        
        if (typeof window !== 'undefined' && window.APP_CONFIG && window.APP_CONFIG._demoMode) {
            console.log('‚ÑπÔ∏è Running in DEMO mode - no Firebase config available');
            return;
        }
        
        // No config found - will use config.js fallback
        console.warn('‚ö†Ô∏è No Firebase config found - using fallback');
    })();
    </script>
</head>
<body>
    <div id="app">
        <!-- Loading state while Firebase initializes -->
        <div class="loading-screen" id="loading-screen">
            <div class="loading-spinner"></div>
            <p>Carregando AgendaEst√©tica...</p>
        </div>
    </div>
    
    <script type="module">
        import firebaseConfig from './config.js';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js';
        import { getAuth, setPersistence, browserLocalPersistence } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js';
        import { getStorage } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-storage.js';
        import { setupRouter } from './router.js';
        import { verificarSessao } from './modules/auth.js';
        
        // Check if we have valid Firebase config
        const hasValidConfig = firebaseConfig && 
                               firebaseConfig.apiKey &&
                               firebaseConfig.apiKey !== 'null' &&
                               firebaseConfig.apiKey !== 'undefined' &&
                               !firebaseConfig.apiKey.includes('placeholder') &&
                               firebaseConfig.apiKey !== '';
        
        // Validate required fields
        const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
        const missingFields = hasValidConfig ? requiredFields.filter(field => !firebaseConfig[field]) : [];
        
        // Don't initialize Firebase if config is invalid
        if (!hasValidConfig) {
            console.warn('‚ö†Ô∏è Firebase config invalid - running in DEMO mode');
            console.warn('   Configure VITE_FIREBASE_* variables in Vercel Dashboard');
            
            // Show demo mode UI
            document.getElementById('loading-screen').innerHTML = `
                <div class="demo-mode-screen">
                    <h2>üß™ Modo Demonstra√ß√£o</h2>
                    <p>O Firebase n√£o est√° configurado corretamente.</p>
                    <p>Configure as vari√°veis de ambiente no Vercel Dashboard:</p>
                    <ul>
                        <li>VITE_FIREBASE_API_KEY</li>
                        <li>VITE_FIREBASE_AUTH_DOMAIN</li>
                        <li>VITE_FIREBASE_PROJECT_ID</li>
                        <li>VITE_FIREBASE_STORAGE_BUCKET</li>
                        <li>VITE_FIREBASE_MESSAGING_SENDER_ID</li>
                        <li>VITE_FIREBASE_APP_ID</li>
                    </ul>
                </div>
            `;
            
            // Still setup router for UI demo
            document.addEventListener('DOMContentLoaded', async () => {
                await setupRouter();
            });
        } else if (missingFields.length > 0) {
            console.error('‚ùå Firebase Configuration Error: Missing fields:', missingFields.join(', '));
            document.getElementById('loading-screen').innerHTML = `
                <div class="error-screen">
                    <h2>Erro de Configura√ß√£o</h2>
                    <p>Faltam configura√ß√µes do Firebase necess√°rias.</p>
                    <p class="error-details">Campos ausentes: ${missingFields.join(', ')}</p>
                </div>
            `;
            throw new Error('Firebase configuration incomplete');
        } else {
            console.log('‚úÖ Initializing Firebase with valid config');
            
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const storage = getStorage(app);
            
            // Enable persistence for offline support
            setPersistence(auth, browserLocalPersistence)
                .catch(error => console.warn('Persistence error:', error.message));
            
            // Make Firebase services globally available
            window.firebase = {
                app,
                auth,
                db,
                storage,
                firestore: window.firebaseFirestore || db,
            };
            
            // Setup router and check session on load
            document.addEventListener('DOMContentLoaded', async () => {
                try {
                    await setupRouter();
                    await verificarSessao();
                } catch (error) {
                    console.error('Initialization error:', error);
                    document.getElementById('loading-screen').innerHTML = `
                        <div class="error-screen">
                            <h2>Erro ao Inicializar</h2>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            });
        }
    </script>
    
    <style>
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: var(--font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--color-border, #e0e0e0);
            border-top-color: var(--color-primary, #6B46C1);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-screen, .demo-mode-screen {
            text-align: center;
            padding: 24px;
            max-width: 500px;
        }
        
        .demo-mode-screen {
            background: #fff3e0;
            border: 1px solid #ffb74d;
            border-radius: 8px;
        }
        
        .demo-mode-screen h2 {
            color: #e65100;
            margin-bottom: 16px;
        }
        
        .demo-mode-screen ul {
            text-align: left;
            font-size: 12px;
            color: #666;
        }
        
        .error-screen h2 {
            color: var(--color-error, #f44336);
            margin-bottom: 16px;
        }
        
        .error-details {
            font-size: 12px;
            color: var(--color-text-secondary, #666);
            margin-top: 8px;
        }
    </style>
</body>
</html>

